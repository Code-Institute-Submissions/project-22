<!DOCTYPE html>
<html lang="en">
  {% extends 'base.html' %} {% block title %}Upload{% endblock %} {% block
  content %}
  <div class="container form-surround center-align">
    <h2>Upload a puzzle</h2>

    <div class="row">
      <form
        id="upload_puzzle"
        action="{{ url_for('upload_puzzle') }}"
        method="POST"
        class="col s12"
      >
        <div class="row">
          <div class="input-field col s12 m6">
            <input
              id="added_by"
              name="added_by"
              type="text"
              class="validate"
              value="{{session.user}}"
              readonly
            />
            <label for="added_by">Name</label>
          </div>

          <div class="input-field col s12 m6">
            <select
              id="difficulty"
              name="difficulty"
              type="text"
              class="validate"
              required
            >
              <option disabled selected>Difficulty</option>
              {% for category in difficulty %}
              <option value="{{category.difficulty}}"
                >{{category.difficulty.title()}}</option
              >
              {% endfor %}
            </select>
            <label for="difficulty">Difficulty</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12 m6">
            
            <button id="upload_widget" class="cloudinary-button">Upload image</button>
            <div id="thumbnail"></div>
          </div>
          <div class="input-field col s12 m6">
            <input
              id="answer"
              name="answer"
              type="text"
              class="validate"
              required
            />
            <label for="answer">Answer</label>
          </div>
        </div>
        <button
          class="btn waves-effect waves-light"
          type="submit"
          name="action"
        >
          Upload
          <i class="material-icons right">send</i>
        </button>
        
        <input id="image_public_id">
        
      </form>
    </div>
    
  </div>
  
<!--This script -->
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>  

<!--This script configures the Cloudinary connection-->
<script type="text/javascript">  
var myWidget = cloudinary.createUploadWidget({
  cloudName: 'dfboxofas', 
  uploadPreset: 'ikvka7yt',
  multiple: false,
  cropping: true,
  folder: 'project-3',
  form: '#upload_puzzle',
  fieldName: 'image',
  thumbnails: '#thumbnail',
  showCompletedButton: true

  }, (error, result) => { 
    if (!error && result && result.event === "success") { 
      console.log('Done! Here is the image info: ', result.info); 
    }
  }
)

document.getElementById("upload_widget").addEventListener("click", function(){
    myWidget.open();
  }, false);
</script>


<script type="text/javascript">
      $(document).ready(function () {
        console.log("Xtra Document ready!");
        
        $(".cloudinary-fileupload").bind("cloudinarydone", function (e, data) {
            console.log("cloudinarydone function triggered")
          $("#preview").html(
              
            $.cloudinary.image(data.result.public_id, {
              format: data.result.format,
              version: data.result.version,
              crop: "fill",
              width: 150,
              height: 100,
            })
          );
          $(".image_public_id").val(data.result.public_id);
          console.log(data.result.public_id);
          return true;
        });

        $(".cloudinary-fileupload").bind("fileuploadprogress", function (
          e,
          data
        ) {
            console.log("cloudinary fileuploadprogress function triggered")
          $(".progress_bar").css(
            "width",
            Math.round((data.loaded * 100.0) / data.total) + "%"
          );
        });
      });
    </script>

  {% endblock %}
</html>
