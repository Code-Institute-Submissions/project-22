<!DOCTYPE html>
<html lang="en">
  {% extends 'base.html' %} {% block title %}Browse{% endblock %} {% block
  content %}
  <div class="container">
    <div class="row center-align letter_array">|
      {% for letter in alphabet_array %}
      <a href="{{url_for('search', search_category=letter)}}"
        >{{letter.capitalize()}} |
      </a>
      {% endfor %}
    </div>
    <div class="row center-align">
      <div class="col s6">
        <!-- Dropdown Trigger -->
        <a class="dropdown-trigger deep-orange btn" href="#" data-target="dropdown1"
          >Difficulty</a
        >
        <!-- Dropdown Structure -->
        <ul id="dropdown1" class="dropdown-content deep-orange">
          <li>
            <a class="white-text" href="{{url_for('search', search_category='all')}}">All</a>
          </li>
          {% for diff in difficulty %}
          <li>
            <a class="white-text" href="{{url_for('search', search_category=diff.difficulty)}}"
              >{{diff.difficulty.capitalize()}}</a
            >
          </li>
          {% endfor%}
        </ul>
      </div>

      <div class="col s6">
        <!-- Dropdown Trigger -->
        <a class="dropdown-trigger deep-orange btn" href="#" data-target="dropdown2"
          >Contributer</a
        >
        <!-- Dropdown Structure -->
        <ul id="dropdown2" class="dropdown-content deep-orange">
          <li>
            <a class="white-text" href="{{url_for('search', search_category='all')}}">All</a>
          </li>
          {% for contributer in contributers %}
          <li>
            <a class="white-text" 
              href="{{url_for('search', search_category=contributer.username)}}"
              >{{ contributer.username }}</a
            >
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  
  <div class="container">
    <div class="row">
      {% for puzzle in puzzles %}
      <div class="col s6 m4 l2">
        <div class="card ">
          <div class="card-image waves-effect waves-block waves-light">
            <img src="{{puzzle.image}}" />
          </div>
          <div class="card-content">
            <div class="card-title grey-text text-lighten-4"
              ><button class="activator deep-orange text-lighten-1 btn-small btn-flat">See Answer</button></div
            >
            <p class="left-align">
              Difficulty: {{puzzle.difficulty.capitalize()}}
            </p>
            <p class="left-align">Contributer:</p>
            <p class="left-align">{{puzzle.added_by.title()}}</p>
          </div>
          <div class="div thumb-icons">           
            {% if 'user' in session %}
                {% set ns = namespace(liked=false) %}
                {% for item in puzzle.likes %}                       
                    {% if item == session.id %}
                        {% set ns.liked = True %}
                    {% endif %} 
                {% endfor %}
                {% if ns.liked == True %}
                    <a href="{{ url_for('unlike', puzzle_id=puzzle._id)}}">
                        <i class="material-icons left like icon-large">thumb_up</i>
                    </a>
                {% else %}        
                    <a href="{{ url_for('like', puzzle_id=puzzle._id)}}">
                    <i class="material-icons left like">thumb_up</i>
                    </a>     
                {% endif %}                                 
                <p class="like">{{ puzzle.likes|count }}</p>

                {% set ns = namespace(disliked=false) %}
                {% for item in puzzle.dislikes %} 
                    {% if item == session.id %}
                        {% set ns.disliked = True %}
                    {% endif %} 
                {% endfor %}
                {% if ns.disliked == True %}
                    <a href="{{ url_for('undislike', puzzle_id=puzzle._id)}}">
                    <i class="material-icons left dislike icon-large">thumb_down</i></a>
                {% else %}
                    <a href="{{ url_for('dislike', puzzle_id=puzzle._id)}}">
                    <i class="material-icons left dislike">thumb_down</i></a>
                {% endif %}
                <p class="dislike">{{ puzzle.dislikes|count }}</p>                 
            {% else %}
                <i class="material-icons left">thumb_up</i>
                <p class="like">{{ puzzle.likes|count }}</p>
                <i class="material-icons left">thumb_down</i>
                <p class="dislike">{{ puzzle.dislikes|count }}</p>               
            {% endif %}
          </div>
          <div class="card-reveal">
            <span class="card-title grey-text text-darken-4"
              >Answer<i class="material-icons right">close</i></span
            >
            <p class="left-align">
              {{puzzle.answer.title()}}
            </p>
          </div>
        </div>
      </div>

      {% endfor %}
    </div>
  </div>
  
  {% endblock %}
</html>
